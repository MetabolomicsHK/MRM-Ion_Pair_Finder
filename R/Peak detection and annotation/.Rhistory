# Used for peak detection and annotation
library(xcms)
library(MSnbase)
library(CAMERA)
library(stringr)
# Get the full path to the mzXML files
mzxml <- dir('D:\\github\\MRM-Ion_Pair_Finder\\Data\\mzXML',full.names = T,recursive = TRUE)
mzxml
# Peak detection & alignment
xset <- xcmsSet(mzxml, ppm = 20, snthresh = 3, method = 'centWave', peakwidth = c(8, 30), noise= 1000)
xset2 <- group(xset, minfrac = 1)
xset2 <- retcor(xset2, method = 'obiwarp', plottype = 'deviation')
xset2 <- group(xset2, bw = 20, minfrac = 1)
# Filling gaps
xset3 <- fillPeaks(xset2)
feature.info <- xcms::groups(xset3)
# Create an xsAnnotate object
xa <- xsAnnotate(xset3)
# Group after RT value of the xcms grouped peak
xag <- groupFWHM(xa, perfwhm=0.6)
# Verify grouping
xac <- groupCorr(xag)
# Annotate isotopes, could be done before groupCorr
xac.isotope <- findIsotopes(xac)
# Annotate adducts
xac.addu <- findAdducts(xac.isotope, polarity="positive")
# Get final peaktable and store on harddrive
res.anno <- getPeaklist(xac.addu)
